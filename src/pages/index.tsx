import type { NextPage } from 'next'
import Head from 'next/head'
import { trpc } from '../utils/trpc'
import CodeMirror from '@uiw/react-codemirror'
import { useState, useEffect, SyntheticEvent } from 'react'
import { javascript } from '@codemirror/lang-javascript'
import { okaidia } from '@uiw/codemirror-theme-okaidia'
import { eclipse } from '@uiw/codemirror-theme-eclipse'

const languages = ['Javascript', 'Python']
const Home: NextPage = () => {
  // const hello = trpc.useQuery(['example.hello', { text: 'from tRPC' }])
  const [code, setCode] = useState('')
  const submitCode = trpc.useMutation(['codeEnvironments.python'], {
    onError: (err) => {
      console.log(err)
    },
    onSuccess: (data, variables, context) => {
      console.log(data)
    }
  })
  const [theme, handleTheme] = useState('eclipse')
  const handleChange = (string: string) => {
    setCode(string)
  }
  const handleSubmit = (e: SyntheticEvent, code: string) => {
    e.preventDefault()
    submitCode.mutate({ code })
  }

  useEffect(() => {
    var minLines = 10
    var startingValue = ''
    for (var i = 0; i < minLines; i++) {
      startingValue += '\n'
    }
  }, [])
  return (
    <>
      <Head>
        <title>Create T3 App</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className="container grid grid-cols-2">
        <CodeMirror
          height={'100%'}
          theme="dark"
          onChange={(string: string) => {
            handleChange(string)
          }}
          value={code}
          extensions={[javascript({ jsx: true })]}
        />
        <div>
          <ul>
            {languages.map((lang) => {
              return <li key={lang}>{lang}</li>
            })}
          </ul>
          <button
            type="submit"
            className=""
            onClick={(e: SyntheticEvent) => handleSubmit(e, code)}
          >
            Run Code
          </button>
        </div>
      </div>
    </>
  )
}
export default Home
